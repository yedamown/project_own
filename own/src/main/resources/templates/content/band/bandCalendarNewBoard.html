<html xmlns:th="http://www.thymeleaf.org"lang="ko">
<script src="/css/band/js/jquery-3.2.1.js"></script>
<script src="/css/band/js/json.min.js"></script>
  <head>
    <title>memberCalendarChk</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<script src="/css/band/js/jquery-3.2.1.js"></script>
	<script src="/css/band/js/json.min.js"></script>
	 <!-- Bootstrap CSS -->
	<link rel="stylesheet" href="/css/band/vendors/linericon/style.css">
	<link rel="stylesheet" href="/css/band/css/font-awesome.min.css">
	<link rel="stylesheet" href="/css/band/vendors/owl-carousel/owl.carousel.min.css">
	<link rel="stylesheet" href="/css/band/vendors/bootstrap-datepicker/bootstrap-datetimepicker.min.css">
 	<link rel="stylesheet" href="/css/band/vendors/nice-select/css/nice-select.css">
	<link rel="stylesheet" href="/css/band/vendors/owl-carousel/owl.carousel.min.css">
  </head>
  <body>
  <div id="template">
		<form class="wrap" id="frm" name="frm">
			<input type="hidden" th:value="${bandCalendarNo}" id="${bandCalendarNo}" name="bandCalendarNo">
			<input type="hidden" th:value="${bandNo}" id="${bandNo}">
			<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
			<select class="form-group" th:value="*{boardList}" id="bandBoardOptionNo" name="bandBoardOptionNo"  required>
				<option disabled>::ê²Œì‹œíŒì„ ì„ íƒí•´ì£¼ì„¸ìš”::</option>
				<option th:if="${list.bandBoardLine}!='0'" th:each="list : ${boardList}" th:value="${list.bandBoardOptionNo}" th:text="${list.bandBoardName}"></option>
			</select>
			<input placeholder="íƒ€ì´í‹€" th:value="title" type="text" class="form-control" id="bandBoardTitle" name="bandBoardTitle"  required>
			<input placeholder="ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" name="bandBoardContent" th:value="ì¼ì •ê³µìœ ì…ë‹ˆë‹¤." type="text" class="form-control" id="bandBoardContent" required>
		  	<div id="bCalendar"></div>
		  	<div>
		  		<button type="button"  id="writeBtn" class="btn btn-primary mb-2" style="background-color: #f3c300; color:white; float: right">ë“±ë¡</button>
		  	</div>
	  	</form>
  </div>
	<script th:inline="javascript">
	//ì¼ì • ì§€ë„....
	/*<![CDATA[*/
	var calendar = /*[[${calendar}]]*/
   	console.log(calendar);
	var header = /*[[${_csrf.headerName}]]*/
	console.log(header);
	var token = /*[[${_csrf.token}]]*/
   	console.log(token);
	/*]]>*/
 	$(function(){
 		//íƒ€ì´í‹€
			let title = calendar.bandCalendarTitle;
			//íƒ€ì´í‹€ ì €ì¥ë„..
			//ë‚ ì§œ
			let startDay = calendar.bandCalendarStart;
			let endDay = calendar.bandCalendarEnd;
			let sYear = startDay.substr(0, 4);
			let eYear = endDay.substr(0, 4);
			
			startDay = new Date(calendar.bandCalendarStart);
			endDay = new Date(calendar.bandCalendarEnd);
			
			//ë‹¬
			let sMonth = (1+startDay.getMonth());
			let eMonth = (1+endDay.getMonth());
			//ë‚ 
			let sDay = startDay.getDate();
			let eDay = endDay.getDate();
			//ì‹œê°„
			let startTime = startDay.getHours();
			let endTime = endDay.getHours();
			//ë¶„
			let startTime2 = startDay.getMinutes()
			let endTime2 = endDay.getMinutes()
			//ìƒì„¸ì‹œì‘ì‹œê°„
			let sTime = (startTime < 12 ? "ì˜¤ì „" : "ì˜¤í›„")+" "
				sTime += startTime+"ì‹œ "
				sTime += startTime2+"ë¶„";
			//ìƒì„¸ëë‚˜ëŠ”ì‹œê°„
			let eTime = (endTime < 12 ? "ì˜¤ì „" : "ì˜¤í›„")+" " //ì˜¤ì „ ì˜¤í›„
					 + endTime+"ì‹œ " //12ì‹œê°„í‘œê¸°
					 + endTime2+"ë¶„";
			//ì‹œì‘ ìš”ì¼
			let mon = getDayOfWeek(startDay);
			//ê¸€ì“´ì´ ì„ì‹œë¡œ ì•„ì´ë””
			let writer = calendar.userId
			//ë§ˆí¬ìƒ‰
			let color = calendar.bandCalendarMark;
		    let cal  = `<div style="width: 500x; height: 100px; display: flex; justify-content: space-between" id="calendarModal2">`
		    			cal += `<input type="hidden" value="${calendar.bandCalendarNo}" id="bandCalNo">`
		    			cal += `<div style="padding:10px;"><h3 id="jsDD"  style="margin-bottom:0px">${sDay}</h3>`
						cal += `<p id="jsDay">${mon}</p></div>`
						cal += `<div style="padding:10px;"><h5>${title}</h5>`
						cal += `<p id="jsDeDay" style="margin-bottom: 0px">${sYear}ë…„ ${sMonth}ì›” ${sDay}ì¼ ${sTime} ~ ${eYear}ë…„ ${eMonth}ì›” ${eDay}ì¼ ${eTime}</p>`
						cal += `<span style="background-color:${color}">ğŸ’­</span><span>${writer}</span></div>`;
		    $('#bCalendar').empty();
			$('#bCalendar').append(cal);
			//ìš”ì¼ë½‘ê¸°
			function getDayOfWeek(ë‚ ì§œë¬¸ìì—´){ //ex) getDayOfWeek('2022-06-13')
		    	const week = ['ì¼ìš”ì¼', 'ì›”ìš”ì¼', 'í™”ìš”ì¼', 'ìˆ˜ìš”ì¼', 'ëª©ìš”ì¼', 'ê¸ˆìš”ì¼', 'í† ìš”ì¼'];
		    	const dayOfWeek = week[new Date(ë‚ ì§œë¬¸ìì—´).getDay()];
		    	return dayOfWeek;
			}
 	})
 	//ê¸€ì“°ê¸°
	$('#writeBtn').on('click', function(){
		console.log($('#frm').serializeObject());
		$.ajax({
			url : '/own/band/bandGroup/bandCalendarBoardInsert',
			method : 'post',
			data : $('#frm').serializeObject(),
			dataType : 'json',
			beforeSend: function(xhr){
              xhr.setRequestHeader(header,token);
            }
		}).then( res =>{
			console.log(res);
			if(res.bandBoardDetailNo!=null){
				alert('ê¸€ì“°ê¸° ì„±ê³µ');
			} else {
				alert('ê¸€ì“°ê¸° ì‹¤íŒ¨');
			}
		})
	})
  </script>   
  </body>
</html>